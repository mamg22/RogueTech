{% import 'functions.html' as funcs %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juego</title>
    <link rel="shortcut icon" href="{{ url_for('static', filename='main-icon.png') }}" type="image/x-icon">
    <script defer src="{{ url_for('static', filename='astar.js') }}"></script>
    
    {% if config.ENVIRONMENT == 'development' %}
        <script defer src="{{ url_for('web.node_modules', filename='hyperscript.org/dist/_hyperscript.min.js.gz') }}"></script>
        <script defer src="{{ url_for('web.node_modules', filename='chance/dist/chance.min.js') }}"></script>
        <link href="/static/material-icons/material-icons.css" rel="stylesheet">
    {% else %}
        <script defer src="https://unpkg.com/hyperscript.org@0.9.11"></script>
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    {% endif %}

    <script defer src="{{ url_for('static', filename='game.js') }}"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='game.css') }}">
    <script src="{{ url_for('static', filename='main.js')}}"></script>
</head>
<body>
    <div id="game-area">
        <div id="main-hud" class="hud">
            <div class="health-indicator">
                <div><span class="material-icons">health_and_safety</span> <br> 99/100</div>
            </div>
            <div>
                <div class="clickable" _="on click call window.zoom(0.05)">
                    <span class="material-icons">zoom_in</span>
                </div>
                <div class="clickable" _="on click call window.zoom(-0.05)">
                    <span class="material-icons">zoom_out</span>
                </div>
            </div>
            <div class='clickable'
            _="on click call #pause-menu.showModal()"
            ><span class="material-icons md-36">menu</span></div>
    
        </div>
        <div id="game-view">
            <div id="map">
                <table id="map-table"></table>
            </div>
            <div id="entities">
            </div>
        </div>
    </div>
    <div id="messages"></div>

<!-- #region Dialogs -->

{%- call funcs.game_dialog("pause-menu", "Menú") -%}
    <div>
        <input type="checkbox" name="music" id="music"
        _="
        on change
            call set_audio('bgm', not my checked)
        end
        on storage
            set @checked to not typedLocalStorage.getItem('mute-bgm')
        end
        ">
        <label for="music">
            <span class="material-icons">music_note</span>
            Musica
        </label>
    </div>
    <div>
        <input type="checkbox" name="sound" id="sound"
        _="
        on change
            call set_audio('sfx', not my checked)
        end
        on storage
            set @checked to not typedLocalStorage.getItem('mute-sfx')
        end
        ">
        <label for="sound">
            <span class="material-icons">volume</span>
            Sonido
        </label>
    </div>
    <div>
        <button type="submit" _="
        on click
            call #how-to-play.showModal()
        end
        "
        >Cómo jugar</button>
    </div>
    <div>
        <button type="Submit" _="
        on click
            call finish_run()
            call show_gameover()
        end
        "
        >Terminar Partida</button>
    </div>
{%- endcall -%}

{%- call funcs.game_dialog("how-to-play", "Cómo jugar") -%}
{%- endcall -%}

{%- call funcs.game_dialog("gameover-dialog", "Fin de la partida") -%}

Puntución final: <span id="gameover-score"></span> <br>
Tiempo: <span id="gameover-time"></span>

<div>
    <button _="
    on click
        window.upload_score()
    end
    "
    >Subir puntuación</button>
</div>
{%- endcall -%}


<!-- #endregion Dialogs -->

</body>
</html>